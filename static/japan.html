<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹å·æ—…è¡Œå›æ†¶éŒ„ | Kyushu Travel Memory</title>
    <style>
        /* å°å…¥ Google å­—é«” Noto Sans JP å’Œ Orbitron */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&family=Orbitron:wght@400;700;900&display=swap');
        
        /* é€šç”¨ç›’æ¨¡å‹è¨­ç½®ï¼Œç¢ºä¿ä½ˆå±€ä¸€è‡´æ€§ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* é é¢ä¸»é«”æ¨£å¼ï¼šå­—é«”ã€èƒŒæ™¯æ¼¸è®Šã€æ–‡å­—é¡è‰²ã€æº¢å‡ºè™•ç†ã€æœ€å°é«˜åº¦å’Œå®šä½ */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            overflow-x: hidden; /* é˜²æ­¢æ°´å¹³æ»¾å‹• */
            min-height: 100vh; /* ä½”æ»¿æ•´å€‹è¦–çª—é«˜åº¦ */
            position: relative;
        }
        
        /* æ˜Ÿæ˜ŸèƒŒæ™¯æ•ˆæœå®¹å™¨ */
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* å…è¨±é»æ“Šç©¿é€ */
            z-index: 1;
        }
        
        /* å–®å€‹æ˜Ÿæ˜Ÿæ¨£å¼å’Œå‹•ç•« */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite ease-in-out;
        }
        
        /* æ˜Ÿæ˜Ÿé–ƒçˆå‹•ç•« */
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        /* ç­‰å¾…ç•«é¢æ¨£å¼ */
        .waiting-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5); /* åŠé€æ˜ç–ŠåŠ å±¤ */
        }
        
        /* ç­‰å¾…ç•«é¢å…§å®¹å®¹å™¨ */
        .waiting-container {
            background: rgba(255, 255, 255, 0.05);
            /*backdrop-filter: blur(5px);*/
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 60px 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: pulse 2s ease-in-out infinite alternate;
            max-width: 600px;
            width: 100%; /* ç¢ºä¿éŸ¿æ‡‰å¼å¯¬åº¦ */
        }
        
        /* ç­‰å¾…å®¹å™¨è„ˆè¡å‹•ç•« */
        @keyframes pulse {
            from { transform: scale(1); box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3); }
            to { transform: scale(1.02); box-shadow: 0 30px 60px rgba(255, 107, 107, 0.2); }
        }
        
        /* ç­‰å¾…ç•«é¢æ¨™é¡Œæ¨£å¼ï¼Œå¸¶æœ‰æ¼¸è®Šæ–‡å­— */
        .waiting-title {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease infinite;
            margin-bottom: 20px;
        }
        
        /* æ–‡å­—æ¼¸è®Šå‹•ç•« */
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        /* ç­‰å¾…ç•«é¢è¨Šæ¯æ¨£å¼ */
        .waiting-message {
            font-size: 1.3rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        /* å€’æ•¸è¨ˆæ™‚é¡¯ç¤ºæ¨£å¼ */
        .countdown-display {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.6);
            margin: 20px 0;
        }
        
        /* é³¥å±…å…¥å£ç•«é¢æ¨£å¼ */
        .torii-entrance {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: none; /* é è¨­éš±è— */
            flex-direction: column; /* ç¢ºä¿å…§å®¹å‚ç›´å †ç–Š */
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7); /* åŠé€æ˜ç–ŠåŠ å±¤ */
        }
        
        /* é³¥å±…å…¥å£ç•«é¢å…§å®¹å®¹å™¨ */
        .torii-container {
            position: relative;
            animation: toriiAppear 2s ease-out;
            background: rgba(255, 255, 255, 0.05);
            /*backdrop-filter: blur(5px);*/
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 60px 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
        }
        
        /* é³¥å±…å‡ºç¾å‹•ç•« */
        @keyframes toriiAppear {
            from { opacity: 0; transform: scale(0.5) translateY(100px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        /* é³¥å±…åœ–æ¨™æ¨£å¼ï¼Œå¸¶æœ‰ç™¼å…‰æ•ˆæœ */
        .torii-icon {
            font-size: 12rem;
            color: #ff6b6b;
            animation: glow 2s ease-in-out infinite alternate;
            margin-bottom: 30px;
            filter: drop-shadow(0 0 30px rgba(255, 107, 107, 0.8));
        }
        
        /* é³¥å±…åœ–æ¨™ç™¼å…‰å‹•ç•« */
        @keyframes glow {
            from { filter: drop-shadow(0 0 30px rgba(255, 107, 107, 0.8)); }
            to { filter: drop-shadow(0 0 50px rgba(255, 107, 107, 1)) drop-shadow(0 0 100px rgba(255, 107, 107, 0.6)); }
        }
        
        /* é€²å…¥æŒ‰éˆ•æ¨£å¼ï¼Œå¸¶æœ‰æ¼¸è®Šå’Œè„ˆè¡å‹•ç•« */
        .enter-button {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            border-radius: 25px;
            padding: 20px 40px;
            font-size: 1.5rem;
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
            animation: buttonPulse 2s ease-in-out infinite;
        }
        
        /* æŒ‰éˆ•è„ˆè¡å‹•ç•« */
        @keyframes buttonPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* é€²å…¥æŒ‰éˆ•æ‡¸åœæ•ˆæœ */
        .enter-button:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 20px 40px rgba(255, 107, 107, 0.5);
        }
        
        /* ä¹å·åœ°åœ–ç•«é¢æ¨£å¼ */
        .kyushu-map-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: none; /* é è¨­éš±è— */
            padding: 20px;
            overflow-y: auto; /* å…è¨±å…§å®¹æº¢å‡ºæ™‚æ»¾å‹• */
        }
        
        /* åœ°åœ–æ¨™é¡Œæ¨£å¼ */
        .map-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
        }
        
        /* åœ°åœ–æ¨™é¡Œæ¨£å¼ï¼Œå¸¶æœ‰æ¼¸è®Šæ–‡å­— */
        .map-title {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease infinite;
            margin-bottom: 10px;
        }
        
        /* åœ°åœ–å‰¯æ¨™é¡Œæ¨£å¼ */
        .map-subtitle {
            font-size: 1.2rem;
            color: #4ecdc4;
            opacity: 0.9;
        }
        
        /* ä¹å·åœ°åœ–å®¹å™¨æ¨£å¼ï¼šç¾åœ¨ä½¿ç”¨ä¸Šå‚³çš„åœ–ç‰‡ä½œç‚ºèƒŒæ™¯ */
        .kyushu-map {
            max-width: 800px; /* åœ°åœ–å®¹å™¨æœ€å¤§å¯¬åº¦ */
            margin: 0 auto; /* æ°´å¹³å±…ä¸­åœ°åœ– */
            position: relative;
            background-image: url('/static/japan_map.png'); /* å°‡ä¸Šå‚³çš„åœ–ç‰‡è¨­ç½®ç‚ºèƒŒæ™¯ */
            background-size: contain; /* ç¢ºä¿æ•´å€‹åœ–ç‰‡åœ¨å®¹å™¨å…§å¯è¦‹ */
            background-position: center; /* å±…ä¸­èƒŒæ™¯åœ–ç‰‡ */
            background-repeat: no-repeat; /* ä¸é‡è¤‡åœ–ç‰‡ */
            padding-bottom: 75%; /* ä¿æŒ 4:3 æ¯”ä¾‹ï¼ˆé«˜åº¦ç‚ºå¯¬åº¦çš„ 75%ï¼‰ä½œç‚ºåœ°åœ–å€åŸŸ */
            height: 0; /* å¯¦ç¾ padding-bottom æ¯”ä¾‹æŠ€å·§æ‰€éœ€ */
            overflow: hidden; /* éš±è—ä»»ä½•æº¢å‡ºå…§å®¹ */
            border-radius: 20px; /* ä¿æŒåœ“è§’ */
            /*box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);*/ /* æ·»åŠ å¾®å¦™çš„é™°å½± */
        }

        /* èª¿æ•´å„ç¸£å¸‚çš„å®šä½ï¼Œä½¿å…¶èˆ‡åœ°åœ–èƒŒæ™¯å°é½Šä»¥å¯¦ç¾éŸ¿æ‡‰å¼ä½ˆå±€ */
        .prefecture {
            position: absolute;
            background: rgba(78, 205, 196, 0.2); /* äº’å‹•å€åŸŸçš„åŠé€æ˜èƒŒæ™¯ */
            border: 2px solid #4ecdc4; /* äº’å‹•å€åŸŸçš„é‚Šæ¡† */
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 700;
            backdrop-filter: blur(5px); /* äº’å‹•å€åŸŸçš„æ¨¡ç³Šæ•ˆæœ */
            color: white; /* ç¢ºä¿æ–‡å­—å¯è¦‹ */
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ›è¡Œ */
            font-size: 1rem; /* ç¸£å¸‚é è¨­å­—é«”å¤§å° */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex; /* ä½¿ç”¨ flexbox å‚ç›´å’Œæ°´å¹³å±…ä¸­å…§å®¹ */
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* å„ç¸£å¸‚çš„å…·é«”å®šä½å’Œå°ºå¯¸ï¼Œä»¥é©æ‡‰èƒŒæ™¯åœ°åœ– */
        .prefecture[data-prefecture="ç¦å²¡"] { top: 22%; left: 38%; width: 12%; height: 12%; }
        .prefecture[data-prefecture="ç†Šæœ¬"] { top: 45%; left: 39%; width: 10%; height: 10%; }
        .prefecture[data-prefecture="é¹¿å…’å³¶"] { top: 67%; left: 35%; width: 10%; height: 10%; }
        .prefecture[data-prefecture="å¤§åˆ†"] { top: 30%; left: 55%; width: 12%; height: 12%; }
        .prefecture[data-prefecture="å®®å´"] { top: 55%; left: 53%; width: 12%; height: 12%; }

        /* ç¸£å¸‚æ‡¸åœæ•ˆæœ */
        .prefecture:hover {
            background: rgba(78, 205, 196, 0.4);
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(78, 205, 196, 0.3);
        }
        
        /* å·²è¨ªå•ç¸£å¸‚çš„æ¨£å¼ */
        .prefecture.visited {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
        }
        .prefecture.visited:hover {
            animation: visitedGlow 2s ease-in-out infinite alternate;
        }
        
        /* å·²è¨ªå•ç¸£å¸‚çš„ç™¼å…‰å‹•ç•« */
        @keyframes visitedGlow {
            from { box-shadow: 0 0 10px rgba(255, 107, 107, 0.5); }
            to { box-shadow: 0 0 25px rgba(255, 107, 107, 0.8); }
        }
        
        /* è©³ç´°è³‡è¨Šå½ˆå‡ºè¦–çª—æ¨£å¼ */
        .detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none; /* é è¨­éš±è— */
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            /*backdrop-filter: blur(5px);*/ /* èƒŒæ™¯å¾®å¦™æ¨¡ç³Š */
        }
        
        /* è©³ç´°è³‡è¨Šå½ˆå‡ºè¦–çª—å…§å®¹å®¹å™¨ */
        .modal-content {
            background: rgb(25, 25, 25);
            /*backdrop-filter: blur(5px);*/
            border-radius: 20px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto; /* å…è¨±å½ˆå‡ºè¦–çª—å…§æ»¾å‹• */
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            animation: modalAppear 0.5s ease-out forwards;
        }

        /* å½ˆå‡ºè¦–çª—å‡ºç¾å‹•ç•« */
        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.8) translateY(50px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        /* å½ˆå‡ºè¦–çª—é—œé–‰æŒ‰éˆ•æ¨£å¼ */
        .close-button {
            position: absolute;
            top: 2.6%;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2001; /* ç¢ºä¿é—œé–‰æŒ‰éˆ•åœ¨å…§å®¹ä¹‹ä¸Š */
        }
        
        .download-button {
            position: absolute;
            top: 3.2%;
            right: 55px;
            background: none;
            border: none;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2001; /* ç¢ºä¿é—œé–‰æŒ‰éˆ•åœ¨å…§å®¹ä¹‹ä¸Š */
        }
        
        /* é—œé–‰æŒ‰éˆ•æ‡¸åœæ•ˆæœ */
        .close-button:hover,.download-button:hover {
            color: #ff6b6b;
            transform: scale(1.2);
        }
        
        /* ç…§ç‰‡ç•«å»Šç¶²æ ¼ä½ˆå±€ */
        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        /* å–®å€‹ç…§ç‰‡é …ç›®æ¨£å¼ */
        .photo-item {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            aspect-ratio: 4/3; /* ä¿æŒåœ–ç‰‡æ¯”ä¾‹ */
            background: rgb(45, 45, 45);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex; /* ç”¨æ–¼å±…ä¸­ä½”ä½ç¬¦ */
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* ç…§ç‰‡é …ç›®æ‡¸åœæ•ˆæœ */
        .photo-item:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }

        /* åœ–ç‰‡å®¹å™¨ï¼Œç”¨æ–¼æ¼¸é€²å¼è¼‰å…¥å’Œæ¨¡ç³Šæ•ˆæœ */
        .photo-item .image-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            background-color: #333; /* è¼‰å…¥å‰çš„èƒŒæ™¯è‰² */
        }

        .photo-item .image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            /*filter: blur(10px);  åˆå§‹æ¨¡ç³Šæ•ˆæœ */
            transition: filter 0.5s ease-out; /* æ¨¡ç³Šéæ¸¡å‹•ç•« */
        }

        .photo-item .image-container img.loaded {
            filter: blur(0); /* è¼‰å…¥å®Œæˆå¾Œç§»é™¤æ¨¡ç³Š */
        }
        
        /* åœ–ç‰‡æœªè¼‰å…¥æ™‚çš„ä½”ä½æ–‡å­—/åœ–æ¨™ */
        .photo-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.2); /* ä½”ä½ç¬¦çš„æ·±è‰²èƒŒæ™¯ */
            z-index: 2; /* ç¢ºä¿åœ¨æ¨¡ç³Šåœ–ç‰‡ä¹‹ä¸Š */
        }

        /* éš±è—çš„é€šç”¨é¡åˆ¥ */
        .hidden {
            display: none !important;
        }

        /* è‡ªå®šç¾©è¨Šæ¯å½ˆå‡ºè¦–çª—æ¨£å¼ */
        .message-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none; /* é è¨­éš±è— */
            justify-content: center;
            align-items: center;
            z-index: 3000; /* é«˜æ–¼è©³ç´°è³‡è¨Šå½ˆå‡ºè¦–çª—çš„å±¤ç´š */
            padding: 20px;
            /*backdrop-filter: blur(5px);*/
        }

        .message-modal-content {
            background: rgba(255, 255, 255, 0.1);
            /*backdrop-filter: blur(5px);*/
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
            animation: modalAppear 0.3s ease-out forwards;
        }

        .message-modal-title {
            font-size: 2rem;
            color: #ff6b6b;
            margin-bottom: 20px;
        }

        .message-modal-body {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .message-modal-button {
            background: linear-gradient(45deg, #4ecdc4, #ff6b6b);
            border: none;
            border-radius: 20px;
            padding: 12px 25px;
            font-size: 1.1rem;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .message-modal-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        /* ç…§ç‰‡ç‡ˆç®±å½ˆå‡ºè¦–çª—æ¨£å¼ */
        .photo-lightbox-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95); /* èšç„¦ç”¨çš„æ·±è‰²èƒŒæ™¯ */
            display: none; /* é è¨­éš±è— */
            justify-content: center;
            align-items: center;
            z-index: 4000; /* æœ€é«˜å±¤ç´š */
            padding: 20px;
            /*backdrop-filter: blur(5px);*/
        }

        .photo-lightbox-content {
            position: relative;
            max-width: 95%;
            max-height: 95%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .photo-lightbox-content img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 15px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            object-fit: contain; /* ç¢ºä¿æ•´å€‹åœ–ç‰‡å¯è¦‹ */
        }

        /* å½±ç‰‡ç•«å»Šæ¨£å¼ */
        .video-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* å–®å€‹å½±ç‰‡é …ç›®æ¨£å¼ */
        .video-item {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            aspect-ratio: 16/9; /* å½±ç‰‡å¸¸è¦‹æ¯”ä¾‹ */
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .video-item:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }

        /* å½±ç‰‡ç¸®åœ– Canvas æ¨£å¼ */
        .video-thumbnail-img {
            width: 100%;
            height: 100%;
            display: block;
            background-color: #000; /* å½±ç‰‡è¼‰å…¥å‰çš„èƒŒæ™¯è‰² */
        }

        .video-play-icon {
            position: absolute;
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
            transition: transform 0.3s ease;
        }

        .video-item:hover .video-play-icon {
            transform: scale(1.2);
        }

        /* å½±ç‰‡ç‡ˆç®±å½ˆå‡ºè¦–çª—æ¨£å¼ */
        .video-lightbox-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none; /* é è¨­éš±è— */
            justify-content: center;
            align-items: center;
            z-index: 5000; /* æœ€é«˜å±¤ç´š */
            padding: 20px;
            /*backdrop-filter: blur(5px);*/
        }

        .video-lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .video-lightbox-content video {
            max-width: 100%;
            max-height: 100%;
            border-radius: 15px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            object-fit: contain;
        }

        /* éŸ¿æ‡‰å¼åª’é«”æŸ¥è©¢ */
        @media (max-width: 768px) {
            .waiting-title, .map-title {
                font-size: 2rem;
            }
            
            .waiting-message {
                font-size: 1rem;
            }
            
            .countdown-display {
                font-size: 1.8rem;
            }
            
            .torii-icon {
                font-size: 8rem;
            }
            
            .enter-button {
                font-size: 1.2rem;
                padding: 15px 30px;
            }
            
            .prefecture {
                font-size: 0.8rem;
                padding: 10px;
                border-radius: 10px;
            }

            .map-subtitle {
                font-size: 1rem;
            }

            .kyushu-map {
                padding: 20px; /* èª¿æ•´å°è¢å¹•çš„å…§é‚Šè· */
                padding-bottom: 75%; /* ä¿æŒæ¯”ä¾‹ */
            }

            .modal-content {
                padding: 20px;
            }

            .close-button {
                font-size: 1.5rem;
                top: 10px;
                right: 15px;
            }

            .download-button {
                font-size: 0.8rem;
                top: 14px;
                right: 50px;
            }

            .photo-gallery, .video-gallery {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }

            .message-modal-content {
                padding: 30px 20px;
            }

            .message-modal-title {
                font-size: 1.5rem;
            }

            .message-modal-body {
                font-size: 0.9rem;
            }

            .video-play-icon {
                font-size: 3rem;
            }
        }

        @media (max-width: 480px) {
            .waiting-container, .torii-container {
                padding: 40px 20px;
            }
            .waiting-title, .map-title {
                font-size: 1.8rem;
            }
            .countdown-display {
                font-size: 1.5rem;
            }
            .torii-icon {
                font-size: 6rem;
            }
            .enter-button {
                font-size: 1rem;
                padding: 12px 25px;
            }
            .prefecture {
                font-size: 0.7rem;
                padding: 8px;
            }
            .upload-progress-container {
                width: 120px; /* æ›´å°çš„è¢å¹•èª¿æ•´å¯¬åº¦ */
                top: 10px;
                right: 10px;
            }
        }

        /* æ–°å¢ä¸Šå‚³æŒ‰éˆ•æ¨£å¼ */
        .upload-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(45deg, #4ecdc4, #ff6b6b);
            border: none;
            border-radius: 50%; /* åœ“å½¢æŒ‰éˆ• */
            width: 60px;
            height: 60px;
            font-size: 2.5rem;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            z-index: 1500; /* ç¢ºä¿åœ¨åœ°åœ–ä¹‹ä¸Š */
        }

        .upload-button:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
        }

        /* ä¸Šå‚³å½ˆå‡ºè¦–çª—æ¨£å¼ */
        .upload-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none; /* é è¨­éš±è— */
            justify-content: center;
            align-items: center;
            z-index: 6000; /* æœ€é«˜å±¤ç´š */
            padding: 20px;
            /*backdrop-filter: blur(5px);*/
        }

        .upload-modal-content {
            background: rgba(255, 255, 255, 0.08);
            /*backdrop-filter: blur(5px);*/
            border-radius: 25px;
            padding: 40px;
            max-width: 650px;
            width: 100%;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: modalAppear 0.5s ease-out forwards;
            color: white;
            text-align: left;
        }

        .upload-modal-content h2 {
            color: #ff6b6b;
            font-size: 2.2rem;
            margin-bottom: 30px;
            text-align: center;
        }

        .upload-form-group {
            margin-bottom: 25px;
        }

        .upload-form-group label {
            display: block;
            font-size: 1.1rem;
            color: #4ecdc4;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .upload-form-group input[type="file"],
        .upload-form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .upload-form-group input[type="file"]::file-selector-button {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 15px;
        }

        .upload-form-group input[type="file"]::file-selector-button:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }

        .upload-form-group input[type="file"]:focus,
        .upload-form-group select:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.3);
        }

        .upload-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .upload-submit-button, .upload-cancel-button {
            padding: 15px 30px;
            border: none;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .upload-submit-button {
            background: linear-gradient(45deg, #4ecdc4, #ff6b6b);
            color: white;
        }

        .upload-submit-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .upload-submit-button:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.7;
            box-shadow: none;
            transform: none;
        }

        .upload-cancel-button {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .upload-cancel-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        /* ä¸Šå‚³ç‹€æ…‹è¨Šæ¯ */
        .upload-status-message {
            text-align: center;
            margin-top: 20px;
            font-size: 1rem;
            font-weight: 500;
            color: #ffe66d; /* é»ƒè‰²è­¦å‘Š/æç¤º */
        }

        .upload-status-message.success {
            color: #4ecdc4; /* ç¶ è‰²æˆåŠŸ */
        }

        .upload-status-message.error {
            color: #ff6b6b; /* ç´…è‰²éŒ¯èª¤ */
        }

        /* æ–°å¢é€²åº¦æ¢å®¹å™¨ */
        .upload-progress-container {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 200px;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            z-index: 7000; /* ç¢ºä¿åœ¨æ‰€æœ‰æ¨¡æ…‹æ¡†ä¹‹ä¸Š */
            display: none; /* é è¨­éš±è— */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* é€²åº¦æ¢æœ¬èº« */
        .upload-progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #ff6b6b);
            border-radius: 5px;
            transition: width 0.3s ease-out; /* å¹³æ»‘éæ¸¡ */
        }

        /* éŸ¿æ‡‰å¼èª¿æ•´ä¸Šå‚³æŒ‰éˆ• */
        @media (max-width: 768px) {
            .upload-button {
                width: 50px;
                height: 50px;
                font-size: 2rem;
                bottom: 20px;
                right: 20px;
            }

            .upload-modal-content {
                padding: 30px 25px;
            }

            .upload-modal-content h2 {
                font-size: 1.8rem;
                margin-bottom: 20px;
            }

            .upload-form-group label {
                font-size: 1rem;
            }

            .upload-form-group input[type="file"],
            .upload-form-group select {
                padding: 10px 12px;
                font-size: 0.9rem;
            }

            .upload-submit-button, .upload-cancel-button {
                padding: 12px 25px;
                font-size: 1rem;
            }

            .upload-buttons {
                gap: 15px;
            }

            .upload-progress-container {
                width: 150px; /* å°è¢å¹•èª¿æ•´å¯¬åº¦ */
                top: 15px;
                right: 15px;
            }
        }

        @media (max-width: 480px) {
            .upload-button {
                width: 45px;
                height: 45px;
                font-size: 1.8rem;
                bottom: 15px;
                right: 15px;
            }
            .upload-modal-content {
                padding: 25px 15px;
            }
            .upload-modal-content h2 {
                font-size: 1.5rem;
            }
            .upload-form-group label {
                font-size: 0.9rem;
            }
            .upload-form-group input[type="file"]::file-selector-button {
                padding: 6px 10px;
                margin-right: 10px;
            }
            .upload-submit-button, .upload-cancel-button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            .upload-progress-container {
                width: 120px; /* æ›´å°çš„è¢å¹•èª¿æ•´å¯¬åº¦ */
                top: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯æ˜Ÿæ˜Ÿæ•ˆæœå®¹å™¨ -->
    <div class="stars"></div>
    
    <!-- ç­‰å¾…ç•«é¢ï¼šåˆå§‹é¡¯ç¤ºï¼Œç•¶è³‡æ–™è¼‰å…¥æˆ–å€’æ•¸è¨ˆæ™‚æ´»èºæ™‚ -->
    <div class="waiting-screen" id="waitingScreen">
        <div class="waiting-container">
            <h1 class="waiting-title">ä¹å·æ—…é€”ä¸­</h1>
            <p class="waiting-message">
                æ—…è¡Œçš„å›æ†¶æ­£åœ¨è’é›†ä¸­...<br>
                è«‹è€å¿ƒç­‰å¾…ï¼Œå¥½å¥½è’é›†ç´ æï¼
            </p>
            <div class="countdown-display" id="countdownDisplay">è¼‰å…¥ä¸­...</div>
        </div>
    </div>
    
    <!-- é³¥å±…å…¥å£ç•«é¢ï¼šå€’æ•¸è¨ˆæ™‚çµæŸå¾Œå‡ºç¾ -->
    <div class="torii-entrance" id="toriiEntrance">
        <div class="torii-container">
            <div class="torii-icon">â›©ï¸</div>
            <!-- é€²å…¥æŒ‰éˆ•ï¼šåˆå§‹ç‚ºç¦ç”¨ç‹€æ…‹ï¼Œå¾…å‹•ç•«çµæŸå¾Œå•Ÿç”¨ -->
            <button class="enter-button" onclick="enterMemories()" disabled>
                è¸å…¥å›æ†¶ä¹‹é–€
            </button>
        </div>
    </div>
    
    <!-- ä¹å·åœ°åœ–ç•«é¢ï¼šé€²å…¥å¾Œé¡¯ç¤ºçš„ä¸»è¦å…§å®¹å€åŸŸ -->
    <div class="kyushu-map-screen" id="mapScreen">
        <div class="map-header">
            <h1 class="map-title">ä¹å·æ—…è¡Œå›æ†¶éŒ„</h1>
            <p class="map-subtitle">é»æ“Šå„ç¸£å¸‚æ¢ç´¢æˆ‘å€‘çš„è¶³è·¡</p>
        </div>
        
        <div class="kyushu-map">
            <!-- ä¹å·å„ç¸£å¸‚ä½œç‚ºäº’å‹•å…ƒç´  -->
            <!-- æ¯å€‹ç¸£å¸‚éƒ½æœ‰ä¸€å€‹ 'visited' é¡åˆ¥ç”¨æ–¼æ¨£å¼ï¼Œä»¥åŠä¸€å€‹ data-prefecture å±¬æ€§ -->
            <!-- 'style' å±¬æ€§è¨­å®šå®ƒå€‘åœ¨åœ°åœ–ä¸Šçš„å¤§è‡´ä½ç½® -->
            <div class="prefecture visited" data-prefecture="ç¦å²¡" onclick="showPrefectureDetail('fukuoka')">
                ç¦å²¡ç¸£<br>Fukuoka
            </div>
            <div class="prefecture visited" data-prefecture="ç†Šæœ¬" onclick="showPrefectureDetail('kumamoto')">
                ç†Šæœ¬ç¸£<br>Kumamoto
            </div>
            <div class="prefecture visited" data-prefecture="é¹¿å…’å³¶" onclick="showPrefectureDetail('kagoshima')">
                é¹¿å…’å³¶ç¸£<br>Kagoshima
            </div>
            <div class="prefecture visited" data-prefecture="å¤§åˆ†" onclick="showPrefectureDetail('oita')">
                å¤§åˆ†ç¸£<br>Oita
            </div>
            <div class="prefecture visited" data-prefecture="å®®å´" onclick="showPrefectureDetail('miyazaki')">
                å®®å´ç¸£<br>Miyazaki
            </div>
        </div>

        <!-- æ–°å¢ä¸Šå‚³æŒ‰éˆ• -->
        <button class="upload-button" onclick="openUploadModal()">+</button>
    </div>
    
    <!-- è©³ç´°è³‡è¨Šå½ˆå‡ºè¦–çª—ï¼šé¡¯ç¤ºç¸£å¸‚è©³ç´°è³‡è¨Šå’Œç…§ç‰‡ -->
    <div class="detail-modal" id="detailModal">
        <div class="modal-content">
            <button class="close-button" onclick="closeModal('detailModal')">&times;</button>
            <div id="modalContent">
                <!-- å‹•æ…‹å…§å®¹å°‡ç”± JavaScript è¼‰å…¥åˆ°æ­¤è™• -->
            </div>
        </div>
    </div>

    <!-- è‡ªå®šç¾©è¨Šæ¯å½ˆå‡ºè¦–çª—ï¼šç”¨æ–¼ä¸€èˆ¬æç¤ºå’Œè¨Šæ¯ -->
    <div class="message-modal" id="messageModal">
        <div class="message-modal-content">
            <h3 class="message-modal-title" id="messageModalTitle"></h3>
            <p class="message-modal-body" id="messageModalBody"></p>
            <button class="message-modal-button" onclick="closeModal('messageModal')">äº†è§£</button>
        </div>
    </div>

    <!-- ç…§ç‰‡ç‡ˆç®±å½ˆå‡ºè¦–çª—ï¼šç”¨æ–¼å…¨è¢å¹•é¡¯ç¤ºç…§ç‰‡ -->
    <div class="photo-lightbox-modal" id="photoLightboxModal">
        <div class="photo-lightbox-content">
            <img id="lightboxImage" src="" alt="æ—…è¡Œç…§ç‰‡">
            <button class="close-button" onclick="closeModal('photoLightboxModal')">&times;</button>
        </div>
    </div>

    <!-- å½±ç‰‡ç‡ˆç®±å½ˆå‡ºè¦–çª—ï¼šç”¨æ–¼å…¨è¢å¹•æ’­æ”¾å½±ç‰‡ -->
    <div class="video-lightbox-modal" id="videoLightboxModal">
        <div class="video-lightbox-content">
            <video id="lightboxVideo" controls autoplay></video>
            <button class="close-button" onclick="closeModal('videoLightboxModal')">&times;</button>
            <a id="downloadButton" class="download-button" href="#" download>â¬‡</a>
        </div>
    </div>

    <!-- æ–°å¢ä¸Šå‚³åª’é«”å½ˆå‡ºè¦–çª— -->
    <div class="upload-modal" id="uploadModal">
        <div class="upload-modal-content">
            <button class="close-button" onclick="closeModal('uploadModal')">&times;</button>
            <h2>ä¸Šå‚³æ—…è¡Œå›æ†¶</h2>
            <form id="uploadForm">
                <div class="upload-form-group">
                    <label for="uploadPrefecture">é¸æ“‡ç¸£å¸‚ï¼š</label>
                    <select id="uploadPrefecture" name="prefecture" required>
                        <!-- é¸é …å°‡ç”± JavaScript å‹•æ…‹è¼‰å…¥ -->
                        <option value="">è«‹é¸æ“‡ä¸€å€‹ç¸£å¸‚</option>
                    </select>
                </div>
                <div class="upload-form-group">
                    <label for="uploadImages">ä¸Šå‚³åœ–ç‰‡ (å¯å¤šé¸)ï¼š</label>
                    <input type="file" id="uploadImages" name="images" accept="image/*" multiple>
                </div>
                <div class="upload-form-group">
                    <label for="uploadVideos">ä¸Šå‚³å½±ç‰‡ (å¯å¤šé¸)ï¼š</label>
                    <input type="file" id="uploadVideos" name="videos" accept="video/*" multiple>
                </div>
                <div class="upload-buttons">
                    <button type="submit" class="upload-submit-button" id="uploadSubmitButton">ä¸Šå‚³</button>
                    <button type="button" class="upload-cancel-button" onclick="closeModal('uploadModal')">å–æ¶ˆ</button>
                </div>
                <p class="upload-status-message" id="uploadStatusMessage"></p>
            </form>
        </div>
    </div>

    <!-- ä¸Šå‚³é€²åº¦æ¢å®¹å™¨ -->
    <div class="upload-progress-container" id="uploadProgressBarContainer">
        <div class="upload-progress-bar" id="uploadProgressBar"></div>
    </div>
    
    <script>
        // å…¨åŸŸè®Šæ•¸ï¼Œç”¨æ–¼å€’æ•¸è¨ˆæ™‚ã€ç›®æ¨™è§£é–æ™‚é–“å’Œæ—…è¡Œè³‡æ–™
        let countdownInterval;
        let targetTime = null;
        let travelData = {};
        
        // API é…ç½®
        const API_CONFIG = {
            timeEndpoint: '/api/unlock-time',      // ç²å–è§£é–æ™‚é–“çš„ç«¯é»
            travelDataEndpoint: '/api/travel-data', // ç²å–æ—…è¡Œè³‡æ–™çš„ç«¯é»
            uploadImageEndpoint: '/api/upload/image', // æ–°å¢ï¼šåœ–ç‰‡ä¸Šå‚³ç«¯é»
            uploadVideoEndpoint: '/api/upload/video'  // æ–°å¢ï¼šå½±ç‰‡ä¸Šå‚³ç«¯é»
        };
        
        /**
         * åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼ï¼šå‰µå»ºèƒŒæ™¯æ•ˆæœã€è¼‰å…¥è§£é–æ™‚é–“å’Œæ—…è¡Œè³‡æ–™ï¼Œ
         * ä¸¦é–‹å§‹å€’æ•¸è¨ˆæ™‚/ç‹€æ…‹æª¢æŸ¥ã€‚
         */
        async function init() {
            createStars(); // å‰µå»ºé–ƒçˆçš„æ˜Ÿæ˜ŸèƒŒæ™¯
            await loadUnlockTime(); // è¼‰å…¥è¨˜æ†¶ç›¸ç°¿è§£é–æ™‚é–“
            await loadTravelData(); // è¼‰å…¥æ‰€æœ‰ç¸£å¸‚çš„æ—…è¡Œè³‡æ–™
            checkStatus(); // æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹çš„åˆå§‹æª¢æŸ¥

            // æ¯ç§’æ›´æ–°å€’æ•¸è¨ˆæ™‚
            countdownInterval = setInterval(checkStatus, 1000);

            // ç‚ºä¸Šå‚³è¡¨å–®æ·»åŠ äº‹ä»¶ç›£è½å™¨
            document.getElementById('uploadForm').addEventListener('submit', handleUploadSubmit);
        }
        
        /**
         * è¼‰å…¥è¨˜æ†¶ç›¸ç°¿çš„è§£é–æ™‚é–“ã€‚
         * å¾ API_CONFIG.timeEndpoint ç²å–ã€‚
         */
        async function loadUnlockTime() {
            try {
                const response = await fetch(API_CONFIG.timeEndpoint);
                const data = await response.json();
                targetTime = new Date(data.unlockTime).getTime();
            } catch (error) {
                console.error('è¼‰å…¥è§£é–æ™‚é–“å¤±æ•—:', error);
                // å‚™ç”¨æ–¹æ¡ˆï¼šè¨­å®šé è¨­è§£é–æ™‚é–“ï¼ˆä¾‹å¦‚ï¼Œå¾ç¾åœ¨èµ· 60 ç§’ï¼‰
                targetTime = new Date().getTime() + 60000; 
            }
        }
        
        /**
         * è¼‰å…¥æ¯å€‹ç¸£å¸‚çš„æ—…è¡Œè³‡æ–™ã€‚
         * å¾ API_CONFIG.travelDataEndpoint ç²å–ã€‚
         */
        async function loadTravelData() {
            try {
                const response = await fetch(API_CONFIG.travelDataEndpoint);
                travelData = await response.json();
            } catch (error) {
                console.error('è¼‰å…¥æ—…è¡Œè³‡æ–™å¤±æ•—:', error);
            }
        }
        
        /**
         * æª¢æŸ¥ç•¶å‰æ™‚é–“èˆ‡ç›®æ¨™è§£é–æ™‚é–“ã€‚
         * é¡¯ç¤ºé©ç•¶çš„ç•«é¢ï¼ˆç­‰å¾…ã€é³¥å±…å…¥å£æˆ–åœ°åœ–ï¼‰ã€‚
         */
        function checkStatus() {
            const now = new Date().getTime();
            
            if (targetTime && now >= targetTime) {
                // å¦‚æœé”åˆ°è§£é–æ™‚é–“ï¼Œé¡¯ç¤ºé³¥å±…å…¥å£ç•«é¢
                document.getElementById('waitingScreen').classList.add('hidden');
                document.getElementById('toriiEntrance').style.display = 'flex';

                // ç²å–é³¥å±…å®¹å™¨å’Œé€²å…¥æŒ‰éˆ•
                const toriiContainer = document.querySelector('#toriiEntrance .torii-container');
                const enterButton = document.querySelector('#toriiEntrance .enter-button');

                // ç¢ºä¿æŒ‰éˆ•åœ¨å‹•ç•«é–‹å§‹æ™‚æ˜¯ç¦ç”¨çš„
                enterButton.disabled = true;

                // ç›£è½é³¥å±…å®¹å™¨çš„å‹•ç•«çµæŸäº‹ä»¶ï¼Œå‹•ç•«çµæŸå¾Œå•Ÿç”¨æŒ‰éˆ•
                // å‡è¨­ toriiAppear å‹•ç•«æŒçºŒ 2 ç§’
                toriiContainer.addEventListener('animationend', function handler() {
                    enterButton.disabled = false;
                    // ç§»é™¤äº‹ä»¶ç›£è½å™¨ï¼Œé¿å…é‡è¤‡è§¸ç™¼
                    toriiContainer.removeEventListener('animationend', handler);
                }, { once: true }); // ä½¿ç”¨ { once: true } ç¢ºä¿äº‹ä»¶åªè§¸ç™¼ä¸€æ¬¡

                clearInterval(countdownInterval); // åœæ­¢å€’æ•¸è¨ˆæ™‚
            } else {
                // ä»åœ¨ç­‰å¾…ï¼Œæ›´æ–°å€’æ•¸è¨ˆæ™‚é¡¯ç¤º
                updateCountdown();
            }
        }
        
        /**
         * æ›´æ–°ç­‰å¾…ç•«é¢ä¸Šçš„å€’æ•¸è¨ˆæ™‚å™¨é¡¯ç¤ºã€‚
         */
        function updateCountdown() {
            if (!targetTime) return; // å¦‚æœç›®æ¨™æ™‚é–“æœªè¨­å®šï¼Œå‰‡ä¸åŸ·è¡Œä»»ä½•æ“ä½œ
            
            const now = new Date().getTime();
            const distance = targetTime - now;
            
            if (distance <= 0) {
                // å¦‚æœå€’æ•¸è¨ˆæ™‚çµæŸï¼Œéš±è—é¡¯ç¤ºï¼ˆcheckStatus å°‡è™•ç†ç•«é¢åˆ‡æ›ï¼‰
                document.getElementById('countdownDisplay').textContent = 'å·²é–‹æ”¾ï¼';
                return;
            }
            
            // è¨ˆç®—å‰©é¤˜çš„å°æ™‚ã€åˆ†é˜å’Œç§’æ•¸
            const hours = Math.floor(distance / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            let display = '';
            if (hours > 0) display += hours + 'æ™‚ ';
            display += String(minutes).padStart(2, '0') + 'åˆ† ' + String(seconds).padStart(2, '0')+ 'ç§’';
            
            document.getElementById('countdownDisplay').textContent = display;
        }
        
        /**
         * å¾é³¥å±…å…¥å£ç•«é¢åˆ‡æ›åˆ°ä¹å·åœ°åœ–ä¸»ç•«é¢ã€‚
         */
        function enterMemories() {
            document.getElementById('toriiEntrance').style.display = 'none';
            document.getElementById('mapScreen').style.display = 'block';
        }
        
        /**
         * é¡¯ç¤ºé¸å®šç¸£å¸‚çš„è©³ç´°è³‡è¨Šå½ˆå‡ºè¦–çª—ã€‚
         * ç²å–ä¸¦é¡¯ç¤ºäº®é»ã€ç…§ç‰‡å’Œå½±ç‰‡ã€‚
         * @param {string} prefectureKey - ç¸£å¸‚è³‡æ–™çš„éµï¼ˆä¾‹å¦‚ï¼š'fukuoka'ï¼‰ã€‚
         */
        async function showPrefectureDetail(prefectureKey) {
            const data = travelData[prefectureKey];
            if (!data) {
                // å¦‚æœè³‡æ–™ä¸å¯ç”¨ï¼Œé¡¯ç¤ºè‡ªå®šç¾©è¨Šæ¯å½ˆå‡ºè¦–çª—
                showMessageModal('è³‡æ–™å°šæœªæº–å‚™', 'æ­¤åœ°å€çš„æ—…è¡Œå›æ†¶å°šæœªæ•´ç†å®Œæˆï¼Œè«‹æœŸå¾…ï¼');
                return;
            }
            
            const modalContent = document.getElementById('modalContent');
            
            // å¾ travelData ä¸­ç›´æ¥ç²å–ç…§ç‰‡å’Œå½±ç‰‡è³‡æ–™
            const photos = data.photos || [];
            const videos = data.videos || [];
            
            // æ§‹å»ºå½ˆå‡ºè¦–çª—çš„ HTML å…§å®¹
            modalContent.innerHTML = `
                <h2 style="color: #ff6b6b; font-size: 2rem; margin-bottom: 20px;">${data.name}</h2>
                <p style="font-size: 1.1rem; margin-bottom: 20px; color: rgba(255,255,255,0.8);">${data.description}</p>
                
                <h3 style="color: #4ecdc4; margin: 20px 0;">ç²¾å½©äº®é»</h3>
                <ul style="margin-bottom: 30px; list-style: none; padding-left: 0;">
                    ${data.highlights.map(item => `<li style="margin: 10px 0; padding-left: 20px; position: relative;"><span style="color: #ff6b6b; position: absolute; left: 0;">â€¢</span> ${item}</li>`).join('')}
                </ul>
                
                <h3 style="color: #4ecdc4; margin: 20px 0;">æ—…è¡Œç…§ç‰‡</h3>
                <div class="photo-gallery">
                    ${photos.length > 0 ? photos.map(photoFilename => `
                        <div class="photo-item">
                            <div class="image-container">
                                <img class="lazy-image" 
                                     data-src="/static/photos/${photoFilename}" 
                                     src="/static/photos/lowres/${photoFilename.replace(/\.\w+$/, ".webp")}" 
                                     alt="${data.name} æ—…è¡Œç…§ç‰‡" 
                                     onerror="this.onerror=null;this.src='https://placehold.co/400x300/333/FFF?text=åœ–ç‰‡è¼‰å…¥éŒ¯èª¤'; this.classList.remove('loaded');">
                            </div>
                            <div class="photo-placeholder" style="display: none;">ğŸ“·</div>
                        </div>
                    `).join('') : '<p style="color: rgba(255,255,255,0.7);">æ­¤åœ°å€ç›®å‰æ²’æœ‰ç…§ç‰‡ã€‚</p>'}
                </div>

                <h3 style="color: #4ecdc4; margin: 20px 0;">æ—…è¡Œå½±ç‰‡</h3>
                <div class="video-gallery" id="videoGallery">
                    ${videos.length > 0 ? videos.map(videoFilename => `
                        <div class="video-item">
                            <img class="video-thumbnail-img"
                                data-src="/static/videos/${videoFilename}" 
                                src="/static/videos/lowres/${videoFilename.replace(/\.\w+$/, '.webp')}" 
                                alt="å½±ç‰‡ç¸®åœ–" 
                                onerror="this.onerror=null;this.src='https://placehold.co/400x300/333/FFF?text=å½±ç‰‡è¼‰å…¥éŒ¯èª¤';" />
                            <div class="video-play-icon">â–¶ï¸</div>
                        </div>
                    `).join('') : '<p style="color: rgba(255,255,255,0.7);">æ­¤åœ°å€ç›®å‰æ²’æœ‰å½±ç‰‡ã€‚</p>'}
                </div>
            `;
            
            // é¡¯ç¤ºè©³ç´°è³‡è¨Šå½ˆå‡ºè¦–çª—
            document.getElementById('detailModal').style.display = 'flex';

            // åˆå§‹åŒ–åœ–ç‰‡æ‡¶è¼‰å…¥
            initPhotoPreview();

            // åˆå§‹åŒ–å½±ç‰‡ç¸®åœ–æ‡¶è¼‰å…¥ï¼ˆä½¿ç”¨ Intersection Observerï¼‰
            initVideoPreview();
        }
        
        /**
         * ç²å–æŒ‡å®šç¸£å¸‚çš„ç…§ç‰‡ã€‚
         * æ³¨æ„ï¼šæ­¤å‡½æ•¸ç¾åœ¨ç›´æ¥å¾ `travelData` ç²å–ï¼Œä¸å†é€²è¡Œé¡å¤–çš„ API è«‹æ±‚ã€‚
         * @param {string} prefectureKey - ç¸£å¸‚çš„éµã€‚
         * @returns {Array<string>} ç…§ç‰‡æª”æ¡ˆå/URL çš„é™£åˆ—ã€‚
         */
        async function loadPhotos(prefectureKey) {
            return travelData[prefectureKey]?.photos || [];
        }

        /**
         * ç²å–æŒ‡å®šç¸£å¸‚çš„å½±ç‰‡ã€‚
         * æ³¨æ„ï¼šæ­¤å‡½æ•¸ç¾åœ¨ç›´æ¥å¾ `travelData` ç²å–ï¼Œä¸å†é€²è¡Œé¡å¤–çš„ API è«‹æ±‚ã€‚
         * @param {string} prefectureKey - ç¸£å¸‚çš„éµã€‚
         * @returns {Array<string>} å½±ç‰‡æª”æ¡ˆå/URL çš„é™£åˆ—ã€‚
         */
        async function loadVideos(prefectureKey) {
            return travelData[prefectureKey]?.videos || [];
        }

        function initPhotoPreview() {
            const lazyImages = document.querySelectorAll('.lazy-image');

            lazyImages.forEach(img => {
                // åŠ å…¥è¼‰å…¥å®Œæˆå¾Œçš„æ·¡å…¥å‹•ç•«
                img.onload = () => {
                    img.classList.add('loaded');
                };

                img.onerror = () => {
                    img.src = 'https://placehold.co/400x300/FF0000/FFFFFF?text=è¼‰å…¥å¤±æ•—';
                };

                // é»æ“Šçˆ¶å±¤ .photo-item æ™‚é–‹å•Ÿ Lightboxï¼Œä½¿ç”¨ data-src ä½œç‚ºé«˜æ¸…åœ–
                const photoItem = img.closest('.photo-item');
                if (photoItem) {
                    photoItem.onclick = () => {
                        const highResUrl = img.dataset.src;
                        showPhotoLightbox(highResUrl);
                    };
                }
            });
        }



        /**
         * åˆå§‹åŒ–å½±ç‰‡ç¸®åœ–çš„æ‡¶è¼‰å…¥ã€‚
         */
         function initVideoPreview() {
            document.querySelectorAll('.video-item').forEach(item => {
                const img = item.querySelector('.video-thumbnail-img');
                if (img) {
                    const videoSrc = img.getAttribute('data-src');
                    item.onclick = () => showVideoLightbox(videoSrc);
                }
            });
        }


        /**
         * é—œé–‰æŒ‡å®šçš„å½ˆå‡ºè¦–çª—ã€‚
         * @param {string} modalId - è¦é—œé–‰çš„å½ˆå‡ºè¦–çª—å…ƒç´ çš„ IDã€‚
         */
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modalId === 'videoLightboxModal') {
                const videoElement = document.getElementById('lightboxVideo');
                if (videoElement) {
                    videoElement.pause(); // é—œé–‰å½±ç‰‡ç‡ˆç®±æ™‚æš«åœå½±ç‰‡
                    videoElement.currentTime = 0; // é‡ç½®å½±ç‰‡æ™‚é–“
                }
            } else if (modalId === 'uploadModal') {
                // æ¸…ç©ºä¸Šå‚³è¡¨å–®ä¸¦é‡ç½®ç‹€æ…‹è¨Šæ¯
                document.getElementById('uploadForm').reset();
                document.getElementById('uploadStatusMessage').textContent = '';
                document.getElementById('uploadSubmitButton').disabled = false;
            }
            modal.style.display = 'none';
        }

        /**
         * é¡¯ç¤ºå¸¶æœ‰æ¨™é¡Œå’Œå…§å®¹çš„è‡ªå®šç¾©è¨Šæ¯å½ˆå‡ºè¦–çª—ã€‚
         * @param {string} title - è¨Šæ¯æ¨™é¡Œã€‚
         * @param {string} body - ä¸»è¦å…§å®¹/è¨Šæ¯ã€‚
         */
        function showMessageModal(title, body) {
            document.getElementById('messageModalTitle').textContent = title;
            document.getElementById('messageModalBody').textContent = body;
            document.getElementById('messageModal').style.display = 'flex';
        }

        /**
         * åœ¨ç‡ˆç®±å½ˆå‡ºè¦–çª—ä¸­é¡¯ç¤ºå…¨è¢å¹•ç…§ç‰‡ã€‚
         * @param {string} imageUrl - è¦é¡¯ç¤ºçš„åœ–ç‰‡ URLã€‚
         */
        function showPhotoLightbox(imageUrl) {
            document.getElementById('lightboxImage').src = imageUrl;
            document.getElementById('photoLightboxModal').style.display = 'flex';
        }

        /**
         * åœ¨å½±ç‰‡ç‡ˆç®±å½ˆå‡ºè¦–çª—ä¸­æ’­æ”¾å½±ç‰‡ã€‚
         * @param {string} videoUrl - è¦æ’­æ”¾çš„å½±ç‰‡ URLã€‚
         */
        function showVideoLightbox(videoUrl) {
            const videoElement = document.getElementById('lightboxVideo');
            const downloadButton = document.getElementById('downloadButton');
            videoElement.src = videoUrl;
            downloadButton.href = videoUrl;
            document.getElementById('videoLightboxModal').style.display = 'flex';
            videoElement.play(); // è‡ªå‹•æ’­æ”¾å½±ç‰‡
        }
        
        /**
         * å‰µå»ºæŒ‡å®šæ•¸é‡çš„é–ƒçˆæ˜Ÿæ˜Ÿä½œç‚ºèƒŒæ™¯ã€‚
         */
        function createStars() {
            const starsContainer = document.querySelector('.stars');
            for (let i = 0; i < 20; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        /**
         * é–‹å•Ÿä¸Šå‚³åª’é«”çš„å½ˆå‡ºè¦–çª—ã€‚
         * å‹•æ…‹è¼‰å…¥ç¸£å¸‚é¸é …ã€‚
         */
        function openUploadModal() {
            const uploadPrefectureSelect = document.getElementById('uploadPrefecture');
            // æ¸…ç©ºç¾æœ‰é¸é …ï¼Œé™¤äº†ç¬¬ä¸€å€‹ä½”ä½ç¬¦
            uploadPrefectureSelect.innerHTML = '<option value="">è«‹é¸æ“‡ä¸€å€‹ç¸£å¸‚</option>'; 

            // æ ¹æ“š travelData å‹•æ…‹ç”Ÿæˆç¸£å¸‚é¸é …
            for (const key in travelData) {
                if (travelData.hasOwnProperty(key)) {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = travelData[key].name;
                    uploadPrefectureSelect.appendChild(option);
                }
            }
            document.getElementById('uploadModal').style.display = 'flex';
        }

        /**
         * ä½¿ç”¨ XMLHttpRequest ä¸Šå‚³æª”æ¡ˆä¸¦æä¾›é€²åº¦å›èª¿ã€‚
         * @param {string} url - ä¸Šå‚³ç›®æ¨™ URLã€‚
         * @param {FormData} formData - åŒ…å«æª”æ¡ˆçš„ FormData ç‰©ä»¶ã€‚
         * @param {function} onProgressCallback - é€²åº¦æ›´æ–°å›èª¿å‡½æ•¸ (percentComplete)ã€‚
         * @returns {Promise<object>} - è§£æç‚ºä¼ºæœå™¨éŸ¿æ‡‰çš„ Promiseã€‚
         */
        function uploadFileWithProgress(url, formData, onProgressCallback) {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();

                xhr.open('POST', url, true);

                // é€²åº¦äº‹ä»¶ç›£è½å™¨
                xhr.upload.onprogress = function(event) {
                    if (event.lengthComputable) {
                        const percentComplete = (event.loaded / event.total) * 100;
                        onProgressCallback(percentComplete);
                    }
                };

                // è¼‰å…¥å®Œæˆï¼ˆæˆåŠŸï¼‰äº‹ä»¶
                xhr.onload = function() {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        try {
                            resolve(JSON.parse(xhr.responseText));
                        } catch (e) {
                            reject(new Error('ä¼ºæœå™¨éŸ¿æ‡‰è§£æå¤±æ•—ã€‚'));
                        }
                    } else {
                        try {
                            const errorData = JSON.parse(xhr.responseText);
                            reject(new Error(errorData.error || `ä¸Šå‚³å¤±æ•—ï¼Œç‹€æ…‹ç¢¼ï¼š${xhr.status}`));
                        } catch (e) {
                            reject(new Error(`ä¸Šå‚³å¤±æ•—ï¼Œç‹€æ…‹ç¢¼ï¼š${xhr.status}ã€‚`));
                        }
                    }
                };

                // éŒ¯èª¤äº‹ä»¶
                xhr.onerror = function() {
                    reject(new Error('ç¶²è·¯éŒ¯èª¤æˆ–ä¼ºæœå™¨ç„¡éŸ¿æ‡‰ã€‚'));
                };

                // å–æ¶ˆäº‹ä»¶
                xhr.onabort = function() {
                    reject(new Error('ä¸Šå‚³å·²å–æ¶ˆã€‚'));
                };

                xhr.send(formData);
            });
        }


        /**
         * è™•ç†ä¸Šå‚³è¡¨å–®æäº¤ã€‚
         * @param {Event} event - æäº¤äº‹ä»¶ã€‚
         */
        async function handleUploadSubmit(event) {
            event.preventDefault(); // é˜»æ­¢è¡¨å–®é è¨­æäº¤è¡Œç‚º

            const prefecture = document.getElementById('uploadPrefecture').value;
            const imageFiles = document.getElementById('uploadImages').files;
            const videoFiles = document.getElementById('uploadVideos').files;
            const statusMessage = document.getElementById('uploadStatusMessage');
            const submitButton = document.getElementById('uploadSubmitButton');

            if (!prefecture) {
                statusMessage.textContent = 'è«‹é¸æ“‡ä¸€å€‹ç¸£å¸‚ï¼';
                statusMessage.className = 'upload-status-message error';
                return;
            }

            if (imageFiles.length === 0 && videoFiles.length === 0) {
                statusMessage.textContent = 'è«‹é¸æ“‡è‡³å°‘ä¸€å€‹åœ–ç‰‡æˆ–å½±ç‰‡æª”æ¡ˆï¼';
                statusMessage.className = 'upload-status-message error';
                return;
            }

            submitButton.disabled = true;
            statusMessage.textContent = 'æ­£åœ¨æº–å‚™ä¸Šå‚³...';
            statusMessage.className = 'upload-status-message'; // é‡ç½®ç‚ºé è¨­æ¨£å¼

            // é¡¯ç¤ºé€²åº¦æ¢å®¹å™¨ä¸¦é‡ç½®é€²åº¦
            const progressBarContainer = document.getElementById('uploadProgressBarContainer');
            const progressBar = document.getElementById('uploadProgressBar');
            progressBarContainer.style.display = 'block';
            progressBar.style.width = '0%'; 

            const updateProgressBar = (percent) => {
                progressBar.style.width = percent + '%';
            };

            try {
                // ä¸Šå‚³åœ–ç‰‡
                if (imageFiles.length > 0) {
                    const imageData = new FormData();
                    imageData.append('prefecture', prefecture);
                    for (let i = 0; i < imageFiles.length; i++) {
                        imageData.append('images', imageFiles[i]);
                    }
                    statusMessage.textContent = 'æ­£åœ¨ä¸Šå‚³åœ–ç‰‡ (1/2)...';
                    await uploadFileWithProgress(API_CONFIG.uploadImageEndpoint, imageData, updateProgressBar);
                    console.log('åœ–ç‰‡ä¸Šå‚³æˆåŠŸ');
                    updateProgressBar(0); // åœ–ç‰‡ä¸Šå‚³å®Œæˆå¾Œé‡ç½®é€²åº¦æ¢ï¼Œç‚ºå½±ç‰‡ä¸Šå‚³åšæº–å‚™
                }

                // ä¸Šå‚³å½±ç‰‡
                if (videoFiles.length > 0) {
                    const videoData = new FormData();
                    videoData.append('prefecture', prefecture);
                    for (let i = 0; i < videoFiles.length; i++) {
                        videoData.append('videos', videoFiles[i]);
                    }
                    statusMessage.textContent = 'æ­£åœ¨ä¸Šå‚³å½±ç‰‡ (2/2)...';
                    await uploadFileWithProgress(API_CONFIG.uploadVideoEndpoint, videoData, updateProgressBar);
                    console.log('å½±ç‰‡ä¸Šå‚³æˆåŠŸ');
                }

                statusMessage.textContent = 'æª”æ¡ˆä¸Šå‚³æˆåŠŸï¼';
                statusMessage.className = 'upload-status-message success';
                // é‡æ–°è¼‰å…¥æ—…è¡Œè³‡æ–™ä»¥æ›´æ–°åœ°åœ–ä¸Šçš„å…§å®¹
                await loadTravelData();
                // é—œé–‰æ¨¡æ…‹æ¡†ä¸¦é‡ç½®è¡¨å–®
                setTimeout(() => {
                    closeModal('uploadModal');
                    showMessageModal('ä¸Šå‚³æˆåŠŸ', 'æ‚¨çš„æ—…è¡Œå›æ†¶å·²æˆåŠŸä¸Šå‚³ï¼');
                    progressBarContainer.style.display = 'none'; // æˆåŠŸå¾Œéš±è—é€²åº¦æ¢
                }, 1500);

            } catch (error) {
                console.error('ä¸Šå‚³éŒ¯èª¤:', error);
                statusMessage.textContent = `ä¸Šå‚³å¤±æ•—: ${error.message}`;
                statusMessage.className = 'upload-status-message error';
                submitButton.disabled = false;
                progressBarContainer.style.display = 'none'; // å¤±æ•—å¾Œéš±è—é€²åº¦æ¢
            }
        }
        
        // æ–‡ä»¶è¼‰å…¥å®Œæˆå¾Œå•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
