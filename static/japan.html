<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>九州旅行回憶錄 | Kyushu Travel Memory</title>
    <style>
        /* 導入 Google 字體 Noto Sans JP 和 Orbitron */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&family=Orbitron:wght@400;700;900&display=swap');
        
        /* 通用盒模型設置，確保佈局一致性 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* 頁面主體樣式：字體、背景漸變、文字顏色、溢出處理、最小高度和定位 */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            overflow-x: hidden; /* 防止水平滾動 */
            min-height: 100vh; /* 佔滿整個視窗高度 */
            position: relative;
        }
        
        /* 星星背景效果容器 */
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* 允許點擊穿透 */
            z-index: 1;
        }
        
        /* 單個星星樣式和動畫 */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite ease-in-out;
        }
        
        /* 星星閃爍動畫 */
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        /* 等待畫面樣式 */
        .waiting-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5); /* 半透明疊加層 */
        }
        
        /* 等待畫面內容容器 */
        .waiting-container {
            background: rgba(255, 255, 255, 0.05);
            /*backdrop-filter: blur(5px);*/
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 60px 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: pulse 2s ease-in-out infinite alternate;
            max-width: 600px;
            width: 100%; /* 確保響應式寬度 */
        }
        
        /* 等待容器脈衝動畫 */
        @keyframes pulse {
            from { transform: scale(1); box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3); }
            to { transform: scale(1.02); box-shadow: 0 30px 60px rgba(255, 107, 107, 0.2); }
        }
        
        /* 等待畫面標題樣式，帶有漸變文字 */
        .waiting-title {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease infinite;
            margin-bottom: 20px;
        }
        
        /* 文字漸變動畫 */
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        /* 等待畫面訊息樣式 */
        .waiting-message {
            font-size: 1.3rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        /* 倒數計時顯示樣式 */
        .countdown-display {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.6);
            margin: 20px 0;
        }
        
        /* 鳥居入口畫面樣式 */
        .torii-entrance {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: none; /* 預設隱藏 */
            flex-direction: column; /* 確保內容垂直堆疊 */
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7); /* 半透明疊加層 */
        }
        
        /* 鳥居入口畫面內容容器 */
        .torii-container {
            position: relative;
            animation: toriiAppear 2s ease-out;
            background: rgba(255, 255, 255, 0.05);
            /*backdrop-filter: blur(5px);*/
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 60px 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
        }
        
        /* 鳥居出現動畫 */
        @keyframes toriiAppear {
            from { opacity: 0; transform: scale(0.5) translateY(100px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        /* 鳥居圖標樣式，帶有發光效果 */
        .torii-icon {
            font-size: 12rem;
            color: #ff6b6b;
            animation: glow 2s ease-in-out infinite alternate;
            margin-bottom: 30px;
            filter: drop-shadow(0 0 30px rgba(255, 107, 107, 0.8));
        }
        
        /* 鳥居圖標發光動畫 */
        @keyframes glow {
            from { filter: drop-shadow(0 0 30px rgba(255, 107, 107, 0.8)); }
            to { filter: drop-shadow(0 0 50px rgba(255, 107, 107, 1)) drop-shadow(0 0 100px rgba(255, 107, 107, 0.6)); }
        }
        
        /* 進入按鈕樣式，帶有漸變和脈衝動畫 */
        .enter-button {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            border-radius: 25px;
            padding: 20px 40px;
            font-size: 1.5rem;
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
            animation: buttonPulse 2s ease-in-out infinite;
        }
        
        /* 按鈕脈衝動畫 */
        @keyframes buttonPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* 進入按鈕懸停效果 */
        .enter-button:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 20px 40px rgba(255, 107, 107, 0.5);
        }
        
        /* 九州地圖畫面樣式 */
        .kyushu-map-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: none; /* 預設隱藏 */
            padding: 20px;
            overflow-y: auto; /* 允許內容溢出時滾動 */
        }
        
        /* 地圖標題樣式 */
        .map-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
        }
        
        /* 地圖標題樣式，帶有漸變文字 */
        .map-title {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease infinite;
            margin-bottom: 10px;
        }
        
        /* 地圖副標題樣式 */
        .map-subtitle {
            font-size: 1.2rem;
            color: #4ecdc4;
            opacity: 0.9;
        }
        
        /* 九州地圖容器樣式：現在使用上傳的圖片作為背景 */
        .kyushu-map {
            max-width: 800px; /* 地圖容器最大寬度 */
            margin: 0 auto; /* 水平居中地圖 */
            position: relative;
            background-image: url('/static/japan_map.png'); /* 將上傳的圖片設置為背景 */
            background-size: contain; /* 確保整個圖片在容器內可見 */
            background-position: center; /* 居中背景圖片 */
            background-repeat: no-repeat; /* 不重複圖片 */
            padding-bottom: 75%; /* 保持 4:3 比例（高度為寬度的 75%）作為地圖區域 */
            height: 0; /* 實現 padding-bottom 比例技巧所需 */
            overflow: hidden; /* 隱藏任何溢出內容 */
            border-radius: 20px; /* 保持圓角 */
            /*box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);*/ /* 添加微妙的陰影 */
        }

        /* 調整各縣市的定位，使其與地圖背景對齊以實現響應式佈局 */
        .prefecture {
            position: absolute;
            background: rgba(78, 205, 196, 0.2); /* 互動區域的半透明背景 */
            border: 2px solid #4ecdc4; /* 互動區域的邊框 */
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 700;
            backdrop-filter: blur(5px); /* 互動區域的模糊效果 */
            color: white; /* 確保文字可見 */
            white-space: nowrap; /* 防止文字換行 */
            font-size: 1rem; /* 縣市預設字體大小 */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex; /* 使用 flexbox 垂直和水平居中內容 */
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* 各縣市的具體定位和尺寸，以適應背景地圖 */
        .prefecture[data-prefecture="福岡"] { top: 22%; left: 38%; width: 12%; height: 12%; }
        .prefecture[data-prefecture="熊本"] { top: 45%; left: 39%; width: 10%; height: 10%; }
        .prefecture[data-prefecture="鹿兒島"] { top: 67%; left: 35%; width: 10%; height: 10%; }
        .prefecture[data-prefecture="大分"] { top: 30%; left: 55%; width: 12%; height: 12%; }
        .prefecture[data-prefecture="宮崎"] { top: 55%; left: 53%; width: 12%; height: 12%; }

        /* 縣市懸停效果 */
        .prefecture:hover {
            background: rgba(78, 205, 196, 0.4);
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(78, 205, 196, 0.3);
        }
        
        /* 已訪問縣市的樣式 */
        .prefecture.visited {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
        }
        .prefecture.visited:hover {
            animation: visitedGlow 2s ease-in-out infinite alternate;
        }
        
        /* 已訪問縣市的發光動畫 */
        @keyframes visitedGlow {
            from { box-shadow: 0 0 10px rgba(255, 107, 107, 0.5); }
            to { box-shadow: 0 0 25px rgba(255, 107, 107, 0.8); }
        }
        
        /* 詳細資訊彈出視窗樣式 */
        .detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none; /* 預設隱藏 */
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            /*backdrop-filter: blur(5px);*/ /* 背景微妙模糊 */
        }
        
        /* 詳細資訊彈出視窗內容容器 */
        .modal-content {
            background: rgb(25, 25, 25);
            /*backdrop-filter: blur(5px);*/
            border-radius: 20px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto; /* 允許彈出視窗內滾動 */
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            animation: modalAppear 0.5s ease-out forwards;
        }

        /* 彈出視窗出現動畫 */
        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.8) translateY(50px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        /* 彈出視窗關閉按鈕樣式 */
        .close-button {
            position: absolute;
            top: 2.6%;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2001; /* 確保關閉按鈕在內容之上 */
        }
        
        .download-button {
            position: absolute;
            top: 3.2%;
            right: 55px;
            background: none;
            border: none;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2001; /* 確保關閉按鈕在內容之上 */
        }
        
        /* 關閉按鈕懸停效果 */
        .close-button:hover,.download-button:hover {
            color: #ff6b6b;
            transform: scale(1.2);
        }
        
        /* 照片畫廊網格佈局 */
        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        /* 單個照片項目樣式 */
        .photo-item {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            aspect-ratio: 4/3; /* 保持圖片比例 */
            background: rgb(45, 45, 45);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex; /* 用於居中佔位符 */
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* 照片項目懸停效果 */
        .photo-item:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }

        /* 圖片容器，用於漸進式載入和模糊效果 */
        .photo-item .image-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            background-color: #333; /* 載入前的背景色 */
        }

        .photo-item .image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            /*filter: blur(10px);  初始模糊效果 */
            transition: filter 0.5s ease-out; /* 模糊過渡動畫 */
        }

        .photo-item .image-container img.loaded {
            filter: blur(0); /* 載入完成後移除模糊 */
        }
        
        /* 圖片未載入時的佔位文字/圖標 */
        .photo-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.2); /* 佔位符的深色背景 */
            z-index: 2; /* 確保在模糊圖片之上 */
        }

        /* 隱藏的通用類別 */
        .hidden {
            display: none !important;
        }

        /* 自定義訊息彈出視窗樣式 */
        .message-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none; /* 預設隱藏 */
            justify-content: center;
            align-items: center;
            z-index: 3000; /* 高於詳細資訊彈出視窗的層級 */
            padding: 20px;
            /*backdrop-filter: blur(5px);*/
        }

        .message-modal-content {
            background: rgba(255, 255, 255, 0.1);
            /*backdrop-filter: blur(5px);*/
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
            animation: modalAppear 0.3s ease-out forwards;
        }

        .message-modal-title {
            font-size: 2rem;
            color: #ff6b6b;
            margin-bottom: 20px;
        }

        .message-modal-body {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .message-modal-button {
            background: linear-gradient(45deg, #4ecdc4, #ff6b6b);
            border: none;
            border-radius: 20px;
            padding: 12px 25px;
            font-size: 1.1rem;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .message-modal-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        /* 照片燈箱彈出視窗樣式 */
        .photo-lightbox-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95); /* 聚焦用的深色背景 */
            display: none; /* 預設隱藏 */
            justify-content: center;
            align-items: center;
            z-index: 4000; /* 最高層級 */
            padding: 20px;
            /*backdrop-filter: blur(5px);*/
        }

        .photo-lightbox-content {
            position: relative;
            max-width: 95%;
            max-height: 95%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .photo-lightbox-content img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 15px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            object-fit: contain; /* 確保整個圖片可見 */
        }

        /* 影片畫廊樣式 */
        .video-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* 單個影片項目樣式 */
        .video-item {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            aspect-ratio: 16/9; /* 影片常見比例 */
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .video-item:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }

        /* 影片縮圖 Canvas 樣式 */
        .video-thumbnail-img {
            width: 100%;
            height: 100%;
            display: block;
            background-color: #000; /* 影片載入前的背景色 */
        }

        .video-play-icon {
            position: absolute;
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
            transition: transform 0.3s ease;
        }

        .video-item:hover .video-play-icon {
            transform: scale(1.2);
        }

        /* 影片燈箱彈出視窗樣式 */
        .video-lightbox-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none; /* 預設隱藏 */
            justify-content: center;
            align-items: center;
            z-index: 5000; /* 最高層級 */
            padding: 20px;
            /*backdrop-filter: blur(5px);*/
        }

        .video-lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .video-lightbox-content video {
            max-width: 100%;
            max-height: 100%;
            border-radius: 15px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            object-fit: contain;
        }

        /* 響應式媒體查詢 */
        @media (max-width: 768px) {
            .waiting-title, .map-title {
                font-size: 2rem;
            }
            
            .waiting-message {
                font-size: 1rem;
            }
            
            .countdown-display {
                font-size: 1.8rem;
            }
            
            .torii-icon {
                font-size: 8rem;
            }
            
            .enter-button {
                font-size: 1.2rem;
                padding: 15px 30px;
            }
            
            .prefecture {
                font-size: 0.8rem;
                padding: 10px;
                border-radius: 10px;
            }

            .map-subtitle {
                font-size: 1rem;
            }

            .kyushu-map {
                padding: 20px; /* 調整小螢幕的內邊距 */
                padding-bottom: 75%; /* 保持比例 */
            }

            .modal-content {
                padding: 20px;
            }

            .close-button {
                font-size: 1.5rem;
                top: 10px;
                right: 15px;
            }

            .download-button {
                font-size: 0.8rem;
                top: 14px;
                right: 50px;
            }

            .photo-gallery, .video-gallery {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }

            .message-modal-content {
                padding: 30px 20px;
            }

            .message-modal-title {
                font-size: 1.5rem;
            }

            .message-modal-body {
                font-size: 0.9rem;
            }

            .video-play-icon {
                font-size: 3rem;
            }
        }

        @media (max-width: 480px) {
            .waiting-container, .torii-container {
                padding: 40px 20px;
            }
            .waiting-title, .map-title {
                font-size: 1.8rem;
            }
            .countdown-display {
                font-size: 1.5rem;
            }
            .torii-icon {
                font-size: 6rem;
            }
            .enter-button {
                font-size: 1rem;
                padding: 12px 25px;
            }
            .prefecture {
                font-size: 0.7rem;
                padding: 8px;
            }
            .upload-progress-container {
                width: 120px; /* 更小的螢幕調整寬度 */
                top: 10px;
                right: 10px;
            }
        }

        /* 新增上傳按鈕樣式 */
        .upload-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(45deg, #4ecdc4, #ff6b6b);
            border: none;
            border-radius: 50%; /* 圓形按鈕 */
            width: 60px;
            height: 60px;
            font-size: 2.5rem;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            z-index: 1500; /* 確保在地圖之上 */
        }

        .upload-button:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
        }

        /* 上傳彈出視窗樣式 */
        .upload-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none; /* 預設隱藏 */
            justify-content: center;
            align-items: center;
            z-index: 6000; /* 最高層級 */
            padding: 20px;
            /*backdrop-filter: blur(5px);*/
        }

        .upload-modal-content {
            background: rgba(255, 255, 255, 0.08);
            /*backdrop-filter: blur(5px);*/
            border-radius: 25px;
            padding: 40px;
            max-width: 650px;
            width: 100%;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: modalAppear 0.5s ease-out forwards;
            color: white;
            text-align: left;
        }

        .upload-modal-content h2 {
            color: #ff6b6b;
            font-size: 2.2rem;
            margin-bottom: 30px;
            text-align: center;
        }

        .upload-form-group {
            margin-bottom: 25px;
        }

        .upload-form-group label {
            display: block;
            font-size: 1.1rem;
            color: #4ecdc4;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .upload-form-group input[type="file"],
        .upload-form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .upload-form-group input[type="file"]::file-selector-button {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 15px;
        }

        .upload-form-group input[type="file"]::file-selector-button:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }

        .upload-form-group input[type="file"]:focus,
        .upload-form-group select:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.3);
        }

        .upload-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .upload-submit-button, .upload-cancel-button {
            padding: 15px 30px;
            border: none;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .upload-submit-button {
            background: linear-gradient(45deg, #4ecdc4, #ff6b6b);
            color: white;
        }

        .upload-submit-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .upload-submit-button:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.7;
            box-shadow: none;
            transform: none;
        }

        .upload-cancel-button {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .upload-cancel-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        /* 上傳狀態訊息 */
        .upload-status-message {
            text-align: center;
            margin-top: 20px;
            font-size: 1rem;
            font-weight: 500;
            color: #ffe66d; /* 黃色警告/提示 */
        }

        .upload-status-message.success {
            color: #4ecdc4; /* 綠色成功 */
        }

        .upload-status-message.error {
            color: #ff6b6b; /* 紅色錯誤 */
        }

        /* 新增進度條容器 */
        .upload-progress-container {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 200px;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            z-index: 7000; /* 確保在所有模態框之上 */
            display: none; /* 預設隱藏 */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* 進度條本身 */
        .upload-progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #ff6b6b);
            border-radius: 5px;
            transition: width 0.3s ease-out; /* 平滑過渡 */
        }

        /* 響應式調整上傳按鈕 */
        @media (max-width: 768px) {
            .upload-button {
                width: 50px;
                height: 50px;
                font-size: 2rem;
                bottom: 20px;
                right: 20px;
            }

            .upload-modal-content {
                padding: 30px 25px;
            }

            .upload-modal-content h2 {
                font-size: 1.8rem;
                margin-bottom: 20px;
            }

            .upload-form-group label {
                font-size: 1rem;
            }

            .upload-form-group input[type="file"],
            .upload-form-group select {
                padding: 10px 12px;
                font-size: 0.9rem;
            }

            .upload-submit-button, .upload-cancel-button {
                padding: 12px 25px;
                font-size: 1rem;
            }

            .upload-buttons {
                gap: 15px;
            }

            .upload-progress-container {
                width: 150px; /* 小螢幕調整寬度 */
                top: 15px;
                right: 15px;
            }
        }

        @media (max-width: 480px) {
            .upload-button {
                width: 45px;
                height: 45px;
                font-size: 1.8rem;
                bottom: 15px;
                right: 15px;
            }
            .upload-modal-content {
                padding: 25px 15px;
            }
            .upload-modal-content h2 {
                font-size: 1.5rem;
            }
            .upload-form-group label {
                font-size: 0.9rem;
            }
            .upload-form-group input[type="file"]::file-selector-button {
                padding: 6px 10px;
                margin-right: 10px;
            }
            .upload-submit-button, .upload-cancel-button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            .upload-progress-container {
                width: 120px; /* 更小的螢幕調整寬度 */
                top: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- 背景星星效果容器 -->
    <div class="stars"></div>
    
    <!-- 等待畫面：初始顯示，當資料載入或倒數計時活躍時 -->
    <div class="waiting-screen" id="waitingScreen">
        <div class="waiting-container">
            <h1 class="waiting-title">九州旅途中</h1>
            <p class="waiting-message">
                旅行的回憶正在蒐集中...<br>
                請耐心等待，好好蒐集素材！
            </p>
            <div class="countdown-display" id="countdownDisplay">載入中...</div>
        </div>
    </div>
    
    <!-- 鳥居入口畫面：倒數計時結束後出現 -->
    <div class="torii-entrance" id="toriiEntrance">
        <div class="torii-container">
            <div class="torii-icon">⛩️</div>
            <!-- 進入按鈕：初始為禁用狀態，待動畫結束後啟用 -->
            <button class="enter-button" onclick="enterMemories()" disabled>
                踏入回憶之門
            </button>
        </div>
    </div>
    
    <!-- 九州地圖畫面：進入後顯示的主要內容區域 -->
    <div class="kyushu-map-screen" id="mapScreen">
        <div class="map-header">
            <h1 class="map-title">九州旅行回憶錄</h1>
            <p class="map-subtitle">點擊各縣市探索我們的足跡</p>
        </div>
        
        <div class="kyushu-map">
            <!-- 九州各縣市作為互動元素 -->
            <!-- 每個縣市都有一個 'visited' 類別用於樣式，以及一個 data-prefecture 屬性 -->
            <!-- 'style' 屬性設定它們在地圖上的大致位置 -->
            <div class="prefecture visited" data-prefecture="福岡" onclick="showPrefectureDetail('fukuoka')">
                福岡縣<br>Fukuoka
            </div>
            <div class="prefecture visited" data-prefecture="熊本" onclick="showPrefectureDetail('kumamoto')">
                熊本縣<br>Kumamoto
            </div>
            <div class="prefecture visited" data-prefecture="鹿兒島" onclick="showPrefectureDetail('kagoshima')">
                鹿兒島縣<br>Kagoshima
            </div>
            <div class="prefecture visited" data-prefecture="大分" onclick="showPrefectureDetail('oita')">
                大分縣<br>Oita
            </div>
            <div class="prefecture visited" data-prefecture="宮崎" onclick="showPrefectureDetail('miyazaki')">
                宮崎縣<br>Miyazaki
            </div>
        </div>

        <!-- 新增上傳按鈕 -->
        <button class="upload-button" onclick="openUploadModal()">+</button>
    </div>
    
    <!-- 詳細資訊彈出視窗：顯示縣市詳細資訊和照片 -->
    <div class="detail-modal" id="detailModal">
        <div class="modal-content">
            <button class="close-button" onclick="closeModal('detailModal')">&times;</button>
            <div id="modalContent">
                <!-- 動態內容將由 JavaScript 載入到此處 -->
            </div>
        </div>
    </div>

    <!-- 自定義訊息彈出視窗：用於一般提示和訊息 -->
    <div class="message-modal" id="messageModal">
        <div class="message-modal-content">
            <h3 class="message-modal-title" id="messageModalTitle"></h3>
            <p class="message-modal-body" id="messageModalBody"></p>
            <button class="message-modal-button" onclick="closeModal('messageModal')">了解</button>
        </div>
    </div>

    <!-- 照片燈箱彈出視窗：用於全螢幕顯示照片 -->
    <div class="photo-lightbox-modal" id="photoLightboxModal">
        <div class="photo-lightbox-content">
            <img id="lightboxImage" src="" alt="旅行照片">
            <button class="close-button" onclick="closeModal('photoLightboxModal')">&times;</button>
        </div>
    </div>

    <!-- 影片燈箱彈出視窗：用於全螢幕播放影片 -->
    <div class="video-lightbox-modal" id="videoLightboxModal">
        <div class="video-lightbox-content">
            <video id="lightboxVideo" controls autoplay></video>
            <button class="close-button" onclick="closeModal('videoLightboxModal')">&times;</button>
            <a id="downloadButton" class="download-button" href="#" download>⬇</a>
        </div>
    </div>

    <!-- 新增上傳媒體彈出視窗 -->
    <div class="upload-modal" id="uploadModal">
        <div class="upload-modal-content">
            <button class="close-button" onclick="closeModal('uploadModal')">&times;</button>
            <h2>上傳旅行回憶</h2>
            <form id="uploadForm">
                <div class="upload-form-group">
                    <label for="uploadPrefecture">選擇縣市：</label>
                    <select id="uploadPrefecture" name="prefecture" required>
                        <!-- 選項將由 JavaScript 動態載入 -->
                        <option value="">請選擇一個縣市</option>
                    </select>
                </div>
                <div class="upload-form-group">
                    <label for="uploadImages">上傳圖片 (可多選)：</label>
                    <input type="file" id="uploadImages" name="images" accept="image/*" multiple>
                </div>
                <div class="upload-form-group">
                    <label for="uploadVideos">上傳影片 (可多選)：</label>
                    <input type="file" id="uploadVideos" name="videos" accept="video/*" multiple>
                </div>
                <div class="upload-buttons">
                    <button type="submit" class="upload-submit-button" id="uploadSubmitButton">上傳</button>
                    <button type="button" class="upload-cancel-button" onclick="closeModal('uploadModal')">取消</button>
                </div>
                <p class="upload-status-message" id="uploadStatusMessage"></p>
            </form>
        </div>
    </div>

    <!-- 上傳進度條容器 -->
    <div class="upload-progress-container" id="uploadProgressBarContainer">
        <div class="upload-progress-bar" id="uploadProgressBar"></div>
    </div>
    
    <script>
        // 全域變數，用於倒數計時、目標解鎖時間和旅行資料
        let countdownInterval;
        let targetTime = null;
        let travelData = {};
        
        // API 配置
        const API_CONFIG = {
            timeEndpoint: '/api/unlock-time',      // 獲取解鎖時間的端點
            travelDataEndpoint: '/api/travel-data', // 獲取旅行資料的端點
            uploadImageEndpoint: '/api/upload/image', // 新增：圖片上傳端點
            uploadVideoEndpoint: '/api/upload/video'  // 新增：影片上傳端點
        };
        
        /**
         * 初始化應用程式：創建背景效果、載入解鎖時間和旅行資料，
         * 並開始倒數計時/狀態檢查。
         */
        async function init() {
            createStars(); // 創建閃爍的星星背景
            await loadUnlockTime(); // 載入記憶相簿解鎖時間
            await loadTravelData(); // 載入所有縣市的旅行資料
            checkStatus(); // 應用程式狀態的初始檢查

            // 每秒更新倒數計時
            countdownInterval = setInterval(checkStatus, 1000);

            // 為上傳表單添加事件監聽器
            document.getElementById('uploadForm').addEventListener('submit', handleUploadSubmit);
        }
        
        /**
         * 載入記憶相簿的解鎖時間。
         * 從 API_CONFIG.timeEndpoint 獲取。
         */
        async function loadUnlockTime() {
            try {
                const response = await fetch(API_CONFIG.timeEndpoint);
                const data = await response.json();
                targetTime = new Date(data.unlockTime).getTime();
            } catch (error) {
                console.error('載入解鎖時間失敗:', error);
                // 備用方案：設定預設解鎖時間（例如，從現在起 60 秒）
                targetTime = new Date().getTime() + 60000; 
            }
        }
        
        /**
         * 載入每個縣市的旅行資料。
         * 從 API_CONFIG.travelDataEndpoint 獲取。
         */
        async function loadTravelData() {
            try {
                const response = await fetch(API_CONFIG.travelDataEndpoint);
                travelData = await response.json();
            } catch (error) {
                console.error('載入旅行資料失敗:', error);
            }
        }
        
        /**
         * 檢查當前時間與目標解鎖時間。
         * 顯示適當的畫面（等待、鳥居入口或地圖）。
         */
        function checkStatus() {
            const now = new Date().getTime();
            
            if (targetTime && now >= targetTime) {
                // 如果達到解鎖時間，顯示鳥居入口畫面
                document.getElementById('waitingScreen').classList.add('hidden');
                document.getElementById('toriiEntrance').style.display = 'flex';

                // 獲取鳥居容器和進入按鈕
                const toriiContainer = document.querySelector('#toriiEntrance .torii-container');
                const enterButton = document.querySelector('#toriiEntrance .enter-button');

                // 確保按鈕在動畫開始時是禁用的
                enterButton.disabled = true;

                // 監聽鳥居容器的動畫結束事件，動畫結束後啟用按鈕
                // 假設 toriiAppear 動畫持續 2 秒
                toriiContainer.addEventListener('animationend', function handler() {
                    enterButton.disabled = false;
                    // 移除事件監聽器，避免重複觸發
                    toriiContainer.removeEventListener('animationend', handler);
                }, { once: true }); // 使用 { once: true } 確保事件只觸發一次

                clearInterval(countdownInterval); // 停止倒數計時
            } else {
                // 仍在等待，更新倒數計時顯示
                updateCountdown();
            }
        }
        
        /**
         * 更新等待畫面上的倒數計時器顯示。
         */
        function updateCountdown() {
            if (!targetTime) return; // 如果目標時間未設定，則不執行任何操作
            
            const now = new Date().getTime();
            const distance = targetTime - now;
            
            if (distance <= 0) {
                // 如果倒數計時結束，隱藏顯示（checkStatus 將處理畫面切換）
                document.getElementById('countdownDisplay').textContent = '已開放！';
                return;
            }
            
            // 計算剩餘的小時、分鐘和秒數
            const hours = Math.floor(distance / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            let display = '';
            if (hours > 0) display += hours + '時 ';
            display += String(minutes).padStart(2, '0') + '分 ' + String(seconds).padStart(2, '0')+ '秒';
            
            document.getElementById('countdownDisplay').textContent = display;
        }
        
        /**
         * 從鳥居入口畫面切換到九州地圖主畫面。
         */
        function enterMemories() {
            document.getElementById('toriiEntrance').style.display = 'none';
            document.getElementById('mapScreen').style.display = 'block';
        }
        
        /**
         * 顯示選定縣市的詳細資訊彈出視窗。
         * 獲取並顯示亮點、照片和影片。
         * @param {string} prefectureKey - 縣市資料的鍵（例如：'fukuoka'）。
         */
        async function showPrefectureDetail(prefectureKey) {
            const data = travelData[prefectureKey];
            if (!data) {
                // 如果資料不可用，顯示自定義訊息彈出視窗
                showMessageModal('資料尚未準備', '此地區的旅行回憶尚未整理完成，請期待！');
                return;
            }
            
            const modalContent = document.getElementById('modalContent');
            
            // 從 travelData 中直接獲取照片和影片資料
            const photos = data.photos || [];
            const videos = data.videos || [];
            
            // 構建彈出視窗的 HTML 內容
            modalContent.innerHTML = `
                <h2 style="color: #ff6b6b; font-size: 2rem; margin-bottom: 20px;">${data.name}</h2>
                <p style="font-size: 1.1rem; margin-bottom: 20px; color: rgba(255,255,255,0.8);">${data.description}</p>
                
                <h3 style="color: #4ecdc4; margin: 20px 0;">精彩亮點</h3>
                <ul style="margin-bottom: 30px; list-style: none; padding-left: 0;">
                    ${data.highlights.map(item => `<li style="margin: 10px 0; padding-left: 20px; position: relative;"><span style="color: #ff6b6b; position: absolute; left: 0;">•</span> ${item}</li>`).join('')}
                </ul>
                
                <h3 style="color: #4ecdc4; margin: 20px 0;">旅行照片</h3>
                <div class="photo-gallery">
                    ${photos.length > 0 ? photos.map(photoFilename => `
                        <div class="photo-item">
                            <div class="image-container">
                                <img class="lazy-image" 
                                     data-src="/static/photos/${photoFilename}" 
                                     src="/static/photos/lowres/${photoFilename.replace(/\.\w+$/, ".webp")}" 
                                     alt="${data.name} 旅行照片" 
                                     onerror="this.onerror=null;this.src='https://placehold.co/400x300/333/FFF?text=圖片載入錯誤'; this.classList.remove('loaded');">
                            </div>
                            <div class="photo-placeholder" style="display: none;">📷</div>
                        </div>
                    `).join('') : '<p style="color: rgba(255,255,255,0.7);">此地區目前沒有照片。</p>'}
                </div>

                <h3 style="color: #4ecdc4; margin: 20px 0;">旅行影片</h3>
                <div class="video-gallery" id="videoGallery">
                    ${videos.length > 0 ? videos.map(videoFilename => `
                        <div class="video-item">
                            <img class="video-thumbnail-img"
                                data-src="/static/videos/${videoFilename}" 
                                src="/static/videos/lowres/${videoFilename.replace(/\.\w+$/, '.webp')}" 
                                alt="影片縮圖" 
                                onerror="this.onerror=null;this.src='https://placehold.co/400x300/333/FFF?text=影片載入錯誤';" />
                            <div class="video-play-icon">▶️</div>
                        </div>
                    `).join('') : '<p style="color: rgba(255,255,255,0.7);">此地區目前沒有影片。</p>'}
                </div>
            `;
            
            // 顯示詳細資訊彈出視窗
            document.getElementById('detailModal').style.display = 'flex';

            // 初始化圖片懶載入
            initPhotoPreview();

            // 初始化影片縮圖懶載入（使用 Intersection Observer）
            initVideoPreview();
        }
        
        /**
         * 獲取指定縣市的照片。
         * 注意：此函數現在直接從 `travelData` 獲取，不再進行額外的 API 請求。
         * @param {string} prefectureKey - 縣市的鍵。
         * @returns {Array<string>} 照片檔案名/URL 的陣列。
         */
        async function loadPhotos(prefectureKey) {
            return travelData[prefectureKey]?.photos || [];
        }

        /**
         * 獲取指定縣市的影片。
         * 注意：此函數現在直接從 `travelData` 獲取，不再進行額外的 API 請求。
         * @param {string} prefectureKey - 縣市的鍵。
         * @returns {Array<string>} 影片檔案名/URL 的陣列。
         */
        async function loadVideos(prefectureKey) {
            return travelData[prefectureKey]?.videos || [];
        }

        function initPhotoPreview() {
            const lazyImages = document.querySelectorAll('.lazy-image');

            lazyImages.forEach(img => {
                // 加入載入完成後的淡入動畫
                img.onload = () => {
                    img.classList.add('loaded');
                };

                img.onerror = () => {
                    img.src = 'https://placehold.co/400x300/FF0000/FFFFFF?text=載入失敗';
                };

                // 點擊父層 .photo-item 時開啟 Lightbox，使用 data-src 作為高清圖
                const photoItem = img.closest('.photo-item');
                if (photoItem) {
                    photoItem.onclick = () => {
                        const highResUrl = img.dataset.src;
                        showPhotoLightbox(highResUrl);
                    };
                }
            });
        }



        /**
         * 初始化影片縮圖的懶載入。
         */
         function initVideoPreview() {
            document.querySelectorAll('.video-item').forEach(item => {
                const img = item.querySelector('.video-thumbnail-img');
                if (img) {
                    const videoSrc = img.getAttribute('data-src');
                    item.onclick = () => showVideoLightbox(videoSrc);
                }
            });
        }


        /**
         * 關閉指定的彈出視窗。
         * @param {string} modalId - 要關閉的彈出視窗元素的 ID。
         */
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modalId === 'videoLightboxModal') {
                const videoElement = document.getElementById('lightboxVideo');
                if (videoElement) {
                    videoElement.pause(); // 關閉影片燈箱時暫停影片
                    videoElement.currentTime = 0; // 重置影片時間
                }
            } else if (modalId === 'uploadModal') {
                // 清空上傳表單並重置狀態訊息
                document.getElementById('uploadForm').reset();
                document.getElementById('uploadStatusMessage').textContent = '';
                document.getElementById('uploadSubmitButton').disabled = false;
            }
            modal.style.display = 'none';
        }

        /**
         * 顯示帶有標題和內容的自定義訊息彈出視窗。
         * @param {string} title - 訊息標題。
         * @param {string} body - 主要內容/訊息。
         */
        function showMessageModal(title, body) {
            document.getElementById('messageModalTitle').textContent = title;
            document.getElementById('messageModalBody').textContent = body;
            document.getElementById('messageModal').style.display = 'flex';
        }

        /**
         * 在燈箱彈出視窗中顯示全螢幕照片。
         * @param {string} imageUrl - 要顯示的圖片 URL。
         */
        function showPhotoLightbox(imageUrl) {
            document.getElementById('lightboxImage').src = imageUrl;
            document.getElementById('photoLightboxModal').style.display = 'flex';
        }

        /**
         * 在影片燈箱彈出視窗中播放影片。
         * @param {string} videoUrl - 要播放的影片 URL。
         */
        function showVideoLightbox(videoUrl) {
            const videoElement = document.getElementById('lightboxVideo');
            const downloadButton = document.getElementById('downloadButton');
            videoElement.src = videoUrl;
            downloadButton.href = videoUrl;
            document.getElementById('videoLightboxModal').style.display = 'flex';
            videoElement.play(); // 自動播放影片
        }
        
        /**
         * 創建指定數量的閃爍星星作為背景。
         */
        function createStars() {
            const starsContainer = document.querySelector('.stars');
            for (let i = 0; i < 20; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        /**
         * 開啟上傳媒體的彈出視窗。
         * 動態載入縣市選項。
         */
        function openUploadModal() {
            const uploadPrefectureSelect = document.getElementById('uploadPrefecture');
            // 清空現有選項，除了第一個佔位符
            uploadPrefectureSelect.innerHTML = '<option value="">請選擇一個縣市</option>'; 

            // 根據 travelData 動態生成縣市選項
            for (const key in travelData) {
                if (travelData.hasOwnProperty(key)) {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = travelData[key].name;
                    uploadPrefectureSelect.appendChild(option);
                }
            }
            document.getElementById('uploadModal').style.display = 'flex';
        }

        /**
         * 使用 XMLHttpRequest 上傳檔案並提供進度回調。
         * @param {string} url - 上傳目標 URL。
         * @param {FormData} formData - 包含檔案的 FormData 物件。
         * @param {function} onProgressCallback - 進度更新回調函數 (percentComplete)。
         * @returns {Promise<object>} - 解析為伺服器響應的 Promise。
         */
        function uploadFileWithProgress(url, formData, onProgressCallback) {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();

                xhr.open('POST', url, true);

                // 進度事件監聽器
                xhr.upload.onprogress = function(event) {
                    if (event.lengthComputable) {
                        const percentComplete = (event.loaded / event.total) * 100;
                        onProgressCallback(percentComplete);
                    }
                };

                // 載入完成（成功）事件
                xhr.onload = function() {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        try {
                            resolve(JSON.parse(xhr.responseText));
                        } catch (e) {
                            reject(new Error('伺服器響應解析失敗。'));
                        }
                    } else {
                        try {
                            const errorData = JSON.parse(xhr.responseText);
                            reject(new Error(errorData.error || `上傳失敗，狀態碼：${xhr.status}`));
                        } catch (e) {
                            reject(new Error(`上傳失敗，狀態碼：${xhr.status}。`));
                        }
                    }
                };

                // 錯誤事件
                xhr.onerror = function() {
                    reject(new Error('網路錯誤或伺服器無響應。'));
                };

                // 取消事件
                xhr.onabort = function() {
                    reject(new Error('上傳已取消。'));
                };

                xhr.send(formData);
            });
        }


        /**
         * 處理上傳表單提交。
         * @param {Event} event - 提交事件。
         */
        async function handleUploadSubmit(event) {
            event.preventDefault(); // 阻止表單預設提交行為

            const prefecture = document.getElementById('uploadPrefecture').value;
            const imageFiles = document.getElementById('uploadImages').files;
            const videoFiles = document.getElementById('uploadVideos').files;
            const statusMessage = document.getElementById('uploadStatusMessage');
            const submitButton = document.getElementById('uploadSubmitButton');

            if (!prefecture) {
                statusMessage.textContent = '請選擇一個縣市！';
                statusMessage.className = 'upload-status-message error';
                return;
            }

            if (imageFiles.length === 0 && videoFiles.length === 0) {
                statusMessage.textContent = '請選擇至少一個圖片或影片檔案！';
                statusMessage.className = 'upload-status-message error';
                return;
            }

            submitButton.disabled = true;
            statusMessage.textContent = '正在準備上傳...';
            statusMessage.className = 'upload-status-message'; // 重置為預設樣式

            // 顯示進度條容器並重置進度
            const progressBarContainer = document.getElementById('uploadProgressBarContainer');
            const progressBar = document.getElementById('uploadProgressBar');
            progressBarContainer.style.display = 'block';
            progressBar.style.width = '0%'; 

            const updateProgressBar = (percent) => {
                progressBar.style.width = percent + '%';
            };

            try {
                // 上傳圖片
                if (imageFiles.length > 0) {
                    const imageData = new FormData();
                    imageData.append('prefecture', prefecture);
                    for (let i = 0; i < imageFiles.length; i++) {
                        imageData.append('images', imageFiles[i]);
                    }
                    statusMessage.textContent = '正在上傳圖片 (1/2)...';
                    await uploadFileWithProgress(API_CONFIG.uploadImageEndpoint, imageData, updateProgressBar);
                    console.log('圖片上傳成功');
                    updateProgressBar(0); // 圖片上傳完成後重置進度條，為影片上傳做準備
                }

                // 上傳影片
                if (videoFiles.length > 0) {
                    const videoData = new FormData();
                    videoData.append('prefecture', prefecture);
                    for (let i = 0; i < videoFiles.length; i++) {
                        videoData.append('videos', videoFiles[i]);
                    }
                    statusMessage.textContent = '正在上傳影片 (2/2)...';
                    await uploadFileWithProgress(API_CONFIG.uploadVideoEndpoint, videoData, updateProgressBar);
                    console.log('影片上傳成功');
                }

                statusMessage.textContent = '檔案上傳成功！';
                statusMessage.className = 'upload-status-message success';
                // 重新載入旅行資料以更新地圖上的內容
                await loadTravelData();
                // 關閉模態框並重置表單
                setTimeout(() => {
                    closeModal('uploadModal');
                    showMessageModal('上傳成功', '您的旅行回憶已成功上傳！');
                    progressBarContainer.style.display = 'none'; // 成功後隱藏進度條
                }, 1500);

            } catch (error) {
                console.error('上傳錯誤:', error);
                statusMessage.textContent = `上傳失敗: ${error.message}`;
                statusMessage.className = 'upload-status-message error';
                submitButton.disabled = false;
                progressBarContainer.style.display = 'none'; // 失敗後隱藏進度條
            }
        }
        
        // 文件載入完成後啟動應用程式
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
